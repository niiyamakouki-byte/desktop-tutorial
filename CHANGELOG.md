# Changelog

このプロジェクトのすべての重要な変更を記録します。

---

## [v1.6.0] - 2026-02-12 🎉

### 🎯 リリースハイライト
**プロダクションレベルの完成度達成！** リサイズ機能、依存関係UI、データ永続化、営業日計算の全4機能が完全実装され、建設現場で即座に使える状態になりました。

### 🆕 追加機能

#### データ永続化強化（Hive導入）
- **Hiveベースのローカルストレージ**: SharedPreferencesからHiveへ全面移行
- **自動保存機能**: 編集後3秒で自動的にデータ保存（デバウンス処理）
- **バックアップ・復元UI**: ワンクリックでプロジェクトデータをエクスポート/インポート
  - JSON形式でのデータ保存
  - ファイル名に日時を自動付与
  - AppHeaderにバックアップボタン統合
- **TaskRepository / ProjectRepository**: データアクセス層の完全実装

#### 営業日計算機能
- **CalendarSettings**: 土日・祝日の除外設定をプロジェクト単位で管理
- **WorkingDayCalculator**: 営業日ベースの工期計算エンジン
  - `calculateWorkingDays()`: 2つの日付間の営業日数を計算
  - `addWorkingDays()`: 開始日から営業日ベースで日付を加算
  - `calculateEndDate()`: 期間から終了日を自動計算
- **日本祝日対応**: 2026-2030年の祝日をハードコード
- **CalendarSettingsDialog**: 除外設定を変更するUIダイアログ
- **TaskCascadeServiceとの統合**: 依存関係計算にも営業日ロジックを適用

#### リサイズ機能の完成
- **タスクバー両端ドラッグ**: 左端で開始日、右端で終了日を変更
- **1日単位スナップ**: ドラッグ中に自動的に日単位でスナップ
- **視覚フィードバック**: ホバー時のカーソル変更、ドラッグ中のハイライト
- **触覚フィードバック**: タッチデバイスでのHapticFeedback対応（ドラッグ開始・終了時）
- **最小期間保証**: タスクが0日にならないようにバリデーション
- **営業日連動**: CalendarSettingsに基づいた終了日の自動再計算

#### 依存関係UI強化
- **ビジュアルドラッグ作成**: タスクバー右端🟠からドラッグして依存関係を作成
- **ベジェ曲線描画**: 滑らかな曲線とグロー効果で矢印を描画
- **スナップ機能**: 30px圏内で自動的にターゲットタスクにスナップ
- **依存タイプ選択ダイアログ**: FS/SS/FF/SF + ラグ/リード設定
- **循環依存チェック**: 無効な依存関係を自動検出してエラー表示
- **ESCキーキャンセル**: ドラッグ中にESCキーで操作キャンセル
- **ヒントオーバーレイ**: 画面下部に操作ヒントを表示

### 🔧 改善

- **重複レイヤー削除**: gantt_chart.dartの冗長なDependencyCreationLayerを削除（パフォーマンス向上）
- **コードアーキテクチャ整理**: 状態管理をTimelinePanelに一元化
- **ドキュメント充実**: RESIZE_FEATURE_REPORT.md、DEPENDENCY_UI_PROGRESS.md、HIVE_STORAGE.mdを追加

### 🐛 修正

- Gitブランチ混在問題の解消（feature/drag-resize、feature/dependency-drag、feature/weekend-exclusion、feature/hive-storage）
- データ保存のタイミング問題を解消（デバウンス処理）

### 📚 ドキュメント

- **README.md**: プロジェクト概要、主要機能、技術スタック、開発方法を記載
- **USAGE.md**: 詳細な使い方ガイド（ガントチャート、タスク管理、依存関係、リサイズ、バックアップ、営業日設定）
- **技術レポート**: 各機能の実装詳細を記載したレポートを作成

### ⚡ パフォーマンス

- Hive使用によるデータアクセス高速化
- 不要なウィジェット再描画の削減
- ベジェ曲線描画の最適化

### 🎨 UI/UX

- タッチデバイスでの操作性向上（触覚フィードバック）
- ドラッグ操作のビジュアルフィードバック強化
- バックアップUIの直感的なデザイン

---

## [v1.5.0] - 2026-01-22

### 追加
- **タスクカスケードサービス**: タスク間依存関係の連動スライド
  - 先行タスク遅延→後続タスク自動スライド
  - 玉突き事故防止ロジック
  - クリティカルパス計算
  - 依存チェーントレース（遅延根本原因特定）

- **キャッシュフロー予測**: 「未来の通帳」機能
  - 入金予定（着手金/中間金/完工金）
  - 出金予定（支払いサイト設定対応）
  - 月次キャッシュフローサマリー
  - 資金ショートアラート

- **ゴースト予約（仮押さえ）**: 職人の空き状況管理
  - 確定前の仮押さえ機能
  - 打診→確定のステータス管理
  - 競合チェック

- **業者空き状況**: ◯△✕の3択入力
  - 週次空き状況管理
  - 日付ごとのステータス表示

### 改善
- 工程表日付変更と入金予定の連動

---

## [v1.4.0] - 2026-01-22

### 追加
- **3カラムワークスペース**: デスクトップ/タブレット対応
  - ProjectWorkspace: レスポンシブ3カラムレイアウト
  - 左: タスクナビゲーター
  - 中央: ガントチャート
  - 右: コンテキストパネル

- **モバイルタブ**: スマホ縦向き対応
  - MobileProjectWorkspace: タブ分割UI
  - タスク選択→詳細タブ自動遷移

- **状態一元管理**: UI同期の保証
  - WorkspaceState: 選択状態の一元管理
  - SelectionState: タスク選択とモード連動
  - TaskFilters: クイックフィルター

- **左カラムタスクナビゲーター**:
  - ツリー構造タスク一覧
  - クイックフィルターバー（今日/遅延/待ち/自分）
  - 検索機能
  - クイックアクション

---

## [v1.3.0] - 2026-01-22

### 追加
- **AIアクションカード**: AI提案を現場でワンタップ実行
  - 遅延アラート、コスト警告、天候提案
  - 52pxの大きなアクションボタン（現場対応）
  - HapticFeedback対応
  - 遅延-コスト相関ロジック

- **業者/RFQシステム**: 発注・見積管理
  - Vendor（業者）モデル
  - RFQRequest（見積依頼）モデル
  - RFQResponse（見積回答）モデル
  - TradeCategory（業種分類）
  - VendorRating（業者評価）

- **請求書OCR**: AI請求書処理
  - Invoice（請求書）モデル
  - InvoiceLineItem（明細）モデル
  - OCRResult（OCR結果）モデル
  - InvoiceStatus（ステータス管理）

- **財務ダッシュボード**: 予算消化状況の視覚化
  - BudgetDashboard（予算ダッシュボード）
  - BudgetItem（予算項目）モデル
  - ProjectBudgetSummary（予算サマリー）
  - カテゴリ別内訳表示
  - 今日の利益見込み（モバイル最上部）
  - BudgetOverageAlert（予算超過アラート）

### 改善
- AIアクションサービスで遅延影響額を自動計算
- 雨天遅延とコストの相関分析対応

---

## [v1.2.0] - 2026-01-22

### 追加
- **変更履歴機能**: タスクの変更履歴を追跡・表示（誰がいつ何を変えたか）
- **今日ライン強調**: ガントチャートに今日の縦線を太く表示、今週帯を背景色で強調
- **遅延バー視覚強調**: 遅延タスクに ⚠ +Xd 形式で超過日数を表示
- **依存関係矢印デフォルトON**: 依存関係の矢印表示をデフォルトで有効化
- **タスク選択→右パネル即切替**: タスク選択時に右パネルを自動的に詳細表示に切替

### 改善
- チャット機能の完成度向上

---

## [v1.1.0] - 2026-01-22

### 追加
- **チャットUI改善**: 現場向けに最適化
  - クイック返信機能（了解、完了、確認します、現場到着、遅れます）
  - 48pxの大きなタッチターゲット
  - 16pxフォントで読みやすいメッセージ
  - 行間1.5倍で見やすいテキスト

- **クイックフィルター統合**: ガントチャートにクイックフィルターバーを追加
  - 今日のタスク
  - 遅延タスク
  - 待ちタスク
  - 自分のタスク

- **メッセージバブル改善**:
  - 大きなフォントサイズ（16px）
  - 広めのパディング
  - 読みやすい行間（1.5）

---

## [v1.0.0] - 2026-01-22 🎊 初回リリース

### 🌟 リリースコンセプト
**現場管理者が説明書なしで使える直感的な工程管理ツール**

建設業界向けに特化した、ドラッグ&ドロップベースの高機能ガントチャートアプリケーション。競合製品（APDW Project Compassなど）との差別化ポイントは「圧倒的な操作性の直感性」です。

### 📦 主要機能（リリース時点）

#### ガントチャート
- **フェーズ色分け表示**: 基礎→構造→設備→内装→外構→検査の6フェーズ
  - バトンパス方式の工程管理
  - 各フェーズに専用カラーを割り当て
- **タスクバーのドラッグ移動**: マウスでタスクをドラッグして日程変更
- **依存関係の矢印表示**: タスク間の依存関係を視覚的に表現
- **進捗バーの視覚化**: タスクバー内に進捗率（%）を表示
- **今日ラインの表示**: ガントチャート上の「今日」を明示

#### タスク管理
- **遅延ステータス自動判定**: 
  - 🟢 順調: 予定通り
  - 🟡 リスク: 遅延の可能性あり
  - 🟣 待ち: 他タスクや材料待ち
  - 🔴 超過: 期限超過
- **待ち理由の管理**: 
  - 前工程待ち
  - 材料待ち
  - 承認待ち
  - 天候待ち
  - その他（カスタム入力）
- **添付ファイル対応**: 図面や写真をタスクに紐付け
- **フェーズベースの工程管理**: 工程をフェーズ単位で構造化

#### ダッシュボード
- **今日のTop 5**: 優先度の高いタスクを自動抽出
  - 遅延タスクを優先表示
  - ワンタップで完了・報告
- **プロジェクトサマリー**: 進捗率、残タスク数、遅延数を一覧表示

#### 安全管理機能
- **KY（危険予知）シート**: 現場の危険要因を事前に洗い出し
- **入退場記録**: 作業者の入退場時刻を記録
- **安全チェックリスト**: 日次の安全確認項目

#### データ管理
- **リアルタイム同期アーキテクチャ**: 
  - カーソルベースのポーリング
  - 変更フィード購読
  - オフライン対応
  - 競合解決ロジック
- **ブラウザローカルストレージ**: データをクライアント側で保存

### 🛠️ 技術仕様

#### フロントエンド
- **Flutter Web 3.0+**: クロスプラットフォーム対応
- **Provider**: 状態管理パターン
- **Material Design 3**: モダンなUI/UXデザイン
- **Google Fonts**: Webフォント使用

#### データ層
- **SharedPreferences**: 軽量なキーバリューストレージ（v1.0時点）
- **JSON形式**: データのシリアライゼーション

#### デプロイ
- **GitHub Pages**: 静的ホスティング
- **CI/CD**: GitHub Actionsによる自動デプロイ

### 🎨 UI/UXの特徴

- **現場向け最適化**: 大きなタッチターゲット（48px以上）
- **視認性重視**: 高コントラストの色使い
- **シンプルな操作**: 複雑な設定を排除
- **レスポンシブデザイン**: デスクトップ〜タブレット対応

### 🚀 パフォーマンス

- **初回ロード**: 3秒以内（標準的なネットワーク環境）
- **タスク数制限**: 100タスクまで快適に動作
- **メモリ使用量**: 50MB以下（Chrome）

### 📱 対応環境

| ブラウザ | バージョン | 対応状況 |
|---------|-----------|---------|
| Chrome | 90+ | ✅ 完全対応 |
| Firefox | 88+ | ✅ 完全対応 |
| Safari | 14+ | ✅ 完全対応 |
| Edge | 90+ | ✅ 完全対応 |

### 🎯 ターゲットユーザー

- 建設現場の現場監督
- 工程管理担当者
- 小〜中規模建設会社のプロジェクトマネージャー

### 📖 ドキュメント

- README.md: プロジェクト概要
- 基本的な使い方はアプリ内ツールチップで提供

### 🔒 セキュリティ

- すべてのデータはクライアント側で管理
- 外部サーバーへのデータ送信なし
- HTTPSでの配信（GitHub Pages）

### ⚠️ 既知の制限事項

- データバックアップ機能なし（v1.6.0で追加予定）
- タスクのリサイズ機能なし（v1.6.0で追加予定）
- 土日祝日の除外計算なし（v1.6.0で追加予定）
- モバイル（スマートフォン）対応は限定的

### 🙏 謝辞

建設業界の現場管理者の方々からのフィードバックに感謝いたします。現場の声を反映した、使いやすいツールを目指しています

---

## バージョニングルール

- **パッチ (x.x.X)**: バグ修正
- **マイナー (x.X.0)**: 新機能追加（後方互換性あり）
- **メジャー (X.0.0)**: 破壊的変更

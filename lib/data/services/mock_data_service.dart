import '../models/models.dart';

/// Mock data service providing sample data for the construction project manager
class MockDataService {
  static final MockDataService _instance = MockDataService._internal();
  factory MockDataService() => _instance;
  MockDataService._internal();

  // ============== Users ==============
  final List<User> _users = [
    User(
      id: 'user_1',
      name: '田中 太郎',
      email: 'tanaka@example.com',
      role: UserRole.projectManager,
      department: '工事部',
      isOnline: true,
      avatarUrl: null,
      phone: '090-1234-5678',
    ),
    User(
      id: 'user_2',
      name: '山田 花子',
      email: 'yamada@example.com',
      role: UserRole.siteManager,
      department: '現場管理部',
      isOnline: true,
      avatarUrl: null,
      phone: '090-2345-6789',
    ),
    User(
      id: 'user_3',
      name: '佐藤 次郎',
      email: 'sato@example.com',
      role: UserRole.engineer,
      department: '設計部',
      isOnline: false,
      lastSeen: DateTime.now().subtract(const Duration(hours: 2)),
      avatarUrl: null,
    ),
    User(
      id: 'user_4',
      name: '鈴木 三郎',
      email: 'suzuki@example.com',
      role: UserRole.architect,
      department: '設計部',
      isOnline: true,
      avatarUrl: null,
    ),
    User(
      id: 'user_5',
      name: '高橋 美咲',
      email: 'takahashi@example.com',
      role: UserRole.subcontractor,
      department: '電気工事',
      isOnline: false,
      lastSeen: DateTime.now().subtract(const Duration(days: 1)),
      avatarUrl: null,
    ),
    User(
      id: 'user_6',
      name: '伊藤 健一',
      email: 'ito@example.com',
      role: UserRole.inspector,
      department: '品質管理部',
      isOnline: true,
      avatarUrl: null,
    ),
  ];

  List<User> get users => List.unmodifiable(_users);
  User get currentUser => _users[0];

  // ============== Project ==============
  late final Project _currentProject = Project(
    id: 'proj_1',
    name: '新宿オフィスビル建設プロジェクト',
    description: '地上15階建てオフィスビルの新築工事',
    clientName: '株式会社ABC不動産',
    location: '東京都新宿区西新宿1-1-1',
    startDate: DateTime(2024, 1, 15),
    endDate: DateTime(2025, 6, 30),
    budget: 5000000000,
    status: ProjectStatus.inProgress,
    members: _users,
    createdAt: DateTime(2024, 1, 1),
    updatedAt: DateTime.now(),
  );

  Project get currentProject => _currentProject;

  // ============== Tasks ==============
  List<Task> getTasks() {
    final now = DateTime.now();
    final projectStart = DateTime(2024, 1, 15);

    return [
      // Root level tasks (phases)
      Task(
        id: 'task_1',
        projectId: 'proj_1',
        name: '基礎工事',
        description: '基礎工事フェーズ全体',
        startDate: projectStart,
        endDate: projectStart.add(const Duration(days: 60)),
        progress: 1.0,
        status: 'completed',
        priority: 'high',
        category: 'foundation',
        parentId: null,
        level: 0,
        assignees: [_users[1]],
        createdAt: projectStart,
        updatedAt: now,
      ),
      // Children of 基礎工事
      Task(
        id: 'task_1_1',
        projectId: 'proj_1',
        name: '地盤調査',
        description: '地盤の強度調査',
        startDate: projectStart,
        endDate: projectStart.add(const Duration(days: 14)),
        progress: 1.0,
        status: 'completed',
        priority: 'high',
        category: 'foundation',
        parentId: 'task_1',
        level: 1,
        assignees: [_users[2]],
        createdAt: projectStart,
        updatedAt: now,
      ),
      Task(
        id: 'task_1_2',
        projectId: 'proj_1',
        name: '掘削工事',
        description: '基礎部分の掘削',
        startDate: projectStart.add(const Duration(days: 14)),
        endDate: projectStart.add(const Duration(days: 35)),
        progress: 1.0,
        status: 'completed',
        priority: 'high',
        category: 'foundation',
        parentId: 'task_1',
        level: 1,
        dependsOn: ['task_1_1'],
        assignees: [_users[1]],
        createdAt: projectStart,
        updatedAt: now,
      ),
      Task(
        id: 'task_1_3',
        projectId: 'proj_1',
        name: '基礎コンクリート打設',
        description: '基礎部分のコンクリート工事',
        startDate: projectStart.add(const Duration(days: 35)),
        endDate: projectStart.add(const Duration(days: 60)),
        progress: 1.0,
        status: 'completed',
        priority: 'high',
        category: 'foundation',
        parentId: 'task_1',
        level: 1,
        dependsOn: ['task_1_2'],
        assignees: [_users[1], _users[2]],
        createdAt: projectStart,
        updatedAt: now,
      ),

      // 構造工事
      Task(
        id: 'task_2',
        projectId: 'proj_1',
        name: '構造工事',
        description: '鉄骨構造工事フェーズ',
        startDate: projectStart.add(const Duration(days: 60)),
        endDate: projectStart.add(const Duration(days: 180)),
        progress: 0.75,
        status: 'in_progress',
        priority: 'high',
        category: 'structure',
        parentId: null,
        level: 0,
        dependsOn: ['task_1'],
        assignees: [_users[1]],
        createdAt: projectStart,
        updatedAt: now,
      ),
      Task(
        id: 'task_2_1',
        projectId: 'proj_1',
        name: '1F-5F 鉄骨組立',
        description: '低層階の鉄骨組立',
        startDate: projectStart.add(const Duration(days: 60)),
        endDate: projectStart.add(const Duration(days: 100)),
        progress: 1.0,
        status: 'completed',
        priority: 'high',
        category: 'structure',
        parentId: 'task_2',
        level: 1,
        assignees: [_users[1], _users[2]],
        createdAt: projectStart,
        updatedAt: now,
      ),
      Task(
        id: 'task_2_2',
        projectId: 'proj_1',
        name: '6F-10F 鉄骨組立',
        description: '中層階の鉄骨組立',
        startDate: projectStart.add(const Duration(days: 100)),
        endDate: projectStart.add(const Duration(days: 140)),
        progress: 1.0,
        status: 'completed',
        priority: 'high',
        category: 'structure',
        parentId: 'task_2',
        level: 1,
        dependsOn: ['task_2_1'],
        assignees: [_users[1]],
        createdAt: projectStart,
        updatedAt: now,
      ),
      Task(
        id: 'task_2_3',
        projectId: 'proj_1',
        name: '11F-15F 鉄骨組立',
        description: '高層階の鉄骨組立',
        startDate: projectStart.add(const Duration(days: 140)),
        endDate: projectStart.add(const Duration(days: 180)),
        progress: 0.4,
        status: 'in_progress',
        priority: 'high',
        category: 'structure',
        parentId: 'task_2',
        level: 1,
        dependsOn: ['task_2_2'],
        assignees: [_users[1], _users[2]],
        createdAt: projectStart,
        updatedAt: now,
      ),

      // 電気設備工事
      Task(
        id: 'task_3',
        projectId: 'proj_1',
        name: '電気設備工事',
        description: '電気配線・設備工事',
        startDate: projectStart.add(const Duration(days: 120)),
        endDate: projectStart.add(const Duration(days: 300)),
        progress: 0.3,
        status: 'in_progress',
        priority: 'medium',
        category: 'electrical',
        parentId: null,
        level: 0,
        assignees: [_users[4]],
        createdAt: projectStart,
        updatedAt: now,
      ),
      Task(
        id: 'task_3_1',
        projectId: 'proj_1',
        name: '幹線配線工事',
        description: 'メイン配線の敷設',
        startDate: projectStart.add(const Duration(days: 120)),
        endDate: projectStart.add(const Duration(days: 180)),
        progress: 0.8,
        status: 'in_progress',
        priority: 'high',
        category: 'electrical',
        parentId: 'task_3',
        level: 1,
        assignees: [_users[4]],
        createdAt: projectStart,
        updatedAt: now,
      ),
      Task(
        id: 'task_3_2',
        projectId: 'proj_1',
        name: '分電盤設置',
        description: '各階の分電盤設置',
        startDate: projectStart.add(const Duration(days: 180)),
        endDate: projectStart.add(const Duration(days: 240)),
        progress: 0.0,
        status: 'not_started',
        priority: 'medium',
        category: 'electrical',
        parentId: 'task_3',
        level: 1,
        dependsOn: ['task_3_1'],
        assignees: [_users[4]],
        createdAt: projectStart,
        updatedAt: now,
      ),

      // 配管工事
      Task(
        id: 'task_4',
        projectId: 'proj_1',
        name: '配管工事',
        description: '給排水・空調配管工事',
        startDate: projectStart.add(const Duration(days: 140)),
        endDate: projectStart.add(const Duration(days: 320)),
        progress: 0.2,
        status: 'in_progress',
        priority: 'medium',
        category: 'plumbing',
        parentId: null,
        level: 0,
        assignees: [_users[2]],
        createdAt: projectStart,
        updatedAt: now,
      ),
      Task(
        id: 'task_4_1',
        projectId: 'proj_1',
        name: '給水管敷設',
        description: '給水配管の敷設工事',
        startDate: projectStart.add(const Duration(days: 140)),
        endDate: projectStart.add(const Duration(days: 200)),
        progress: 0.6,
        status: 'in_progress',
        priority: 'medium',
        category: 'plumbing',
        parentId: 'task_4',
        level: 1,
        assignees: [_users[2]],
        createdAt: projectStart,
        updatedAt: now,
      ),
      Task(
        id: 'task_4_2',
        projectId: 'proj_1',
        name: '排水管敷設',
        description: '排水配管の敷設工事',
        startDate: projectStart.add(const Duration(days: 160)),
        endDate: projectStart.add(const Duration(days: 220)),
        progress: 0.3,
        status: 'in_progress',
        priority: 'medium',
        category: 'plumbing',
        parentId: 'task_4',
        level: 1,
        assignees: [_users[2]],
        createdAt: projectStart,
        updatedAt: now,
      ),

      // 仕上げ工事
      Task(
        id: 'task_5',
        projectId: 'proj_1',
        name: '仕上げ工事',
        description: '内装・外装仕上げ工事',
        startDate: projectStart.add(const Duration(days: 250)),
        endDate: projectStart.add(const Duration(days: 450)),
        progress: 0.0,
        status: 'not_started',
        priority: 'medium',
        category: 'finishing',
        parentId: null,
        level: 0,
        dependsOn: ['task_2', 'task_3', 'task_4'],
        assignees: [_users[3]],
        createdAt: projectStart,
        updatedAt: now,
      ),
      Task(
        id: 'task_5_1',
        projectId: 'proj_1',
        name: '外壁工事',
        description: '外壁の施工',
        startDate: projectStart.add(const Duration(days: 250)),
        endDate: projectStart.add(const Duration(days: 350)),
        progress: 0.0,
        status: 'not_started',
        priority: 'medium',
        category: 'finishing',
        parentId: 'task_5',
        level: 1,
        assignees: [_users[3]],
        createdAt: projectStart,
        updatedAt: now,
      ),
      Task(
        id: 'task_5_2',
        projectId: 'proj_1',
        name: '内装工事',
        description: '内装仕上げ工事',
        startDate: projectStart.add(const Duration(days: 300)),
        endDate: projectStart.add(const Duration(days: 420)),
        progress: 0.0,
        status: 'not_started',
        priority: 'medium',
        category: 'finishing',
        parentId: 'task_5',
        level: 1,
        assignees: [_users[3], _users[1]],
        createdAt: projectStart,
        updatedAt: now,
      ),

      // 検査
      Task(
        id: 'task_6',
        projectId: 'proj_1',
        name: '完成検査',
        description: '最終検査・引き渡し',
        startDate: projectStart.add(const Duration(days: 450)),
        endDate: projectStart.add(const Duration(days: 480)),
        progress: 0.0,
        status: 'not_started',
        priority: 'critical',
        category: 'inspection',
        parentId: null,
        level: 0,
        isMilestone: true,
        dependsOn: ['task_5'],
        assignees: [_users[5], _users[0]],
        createdAt: projectStart,
        updatedAt: now,
      ),
    ];
  }

  // ============== Messages ==============
  List<Message> getMessages() {
    final now = DateTime.now();

    return [
      Message(
        id: 'msg_1',
        projectId: 'proj_1',
        senderId: 'user_2',
        sender: _users[1],
        content: 'おはようございます。本日の作業予定を確認しました。11F-15Fの鉄骨組立を進めます。',
        sentAt: now.subtract(const Duration(days: 2, hours: 8)),
        isRead: true,
        readBy: ['user_1', 'user_3', 'user_4'],
      ),
      Message(
        id: 'msg_2',
        projectId: 'proj_1',
        senderId: 'user_1',
        sender: _users[0],
        content: '了解しました。安全に気をつけて作業を進めてください。午後に現場確認に行きます。',
        sentAt: now.subtract(const Duration(days: 2, hours: 7, minutes: 45)),
        isRead: true,
        readBy: ['user_2', 'user_3'],
      ),
      Message(
        id: 'msg_3',
        projectId: 'proj_1',
        senderId: 'user_4',
        sender: _users[3],
        content: '設計変更の件、図面を更新しました。確認をお願いします。',
        sentAt: now.subtract(const Duration(days: 1, hours: 14)),
        isRead: true,
        readBy: ['user_1', 'user_2'],
        attachments: [
          Attachment(
            id: 'att_msg_1',
            projectId: 'proj_1',
            name: '11F_平面図_rev3.pdf',
            url: 'https://example.com/files/11f_plan_rev3.pdf',
            type: 'pdf',
            size: 2500000,
            thumbnailUrl: null,
            uploadedBy: 'user_4',
            uploadedAt: now.subtract(const Duration(days: 1, hours: 14)),
            messageId: 'msg_3',
          ),
        ],
      ),
      Message(
        id: 'msg_4',
        projectId: 'proj_1',
        senderId: 'user_3',
        sender: _users[2],
        content: '電気配線の経路について相談があります。現在の設計だと配管との干渉が発生しそうです。',
        sentAt: now.subtract(const Duration(days: 1, hours: 10)),
        isRead: true,
        readBy: ['user_1', 'user_4', 'user_5'],
      ),
      Message(
        id: 'msg_5',
        projectId: 'proj_1',
        senderId: 'user_5',
        sender: _users[4],
        content: '現場の写真を共有します。該当箇所はここです。',
        sentAt: now.subtract(const Duration(days: 1, hours: 9, minutes: 30)),
        isRead: true,
        readBy: ['user_1', 'user_3', 'user_4'],
        attachments: [
          Attachment(
            id: 'att_msg_2',
            projectId: 'proj_1',
            name: '配線経路_現場写真.jpg',
            url: 'https://example.com/files/wiring_photo.jpg',
            type: 'image',
            size: 3500000,
            thumbnailUrl: 'https://example.com/thumbs/wiring_photo.jpg',
            uploadedBy: 'user_5',
            uploadedAt: now.subtract(const Duration(days: 1, hours: 9, minutes: 30)),
            messageId: 'msg_5',
          ),
        ],
      ),
      Message(
        id: 'msg_6',
        projectId: 'proj_1',
        senderId: 'user_4',
        sender: _users[3],
        content: '確認しました。配管ルートを変更する方向で検討します。明日までに修正案を出します。',
        sentAt: now.subtract(const Duration(days: 1, hours: 8)),
        isRead: true,
        readBy: ['user_1', 'user_3', 'user_5'],
      ),
      Message(
        id: 'msg_7',
        projectId: 'proj_1',
        senderId: 'user_6',
        sender: _users[5],
        content: '来週の中間検査の日程について確認させてください。現在の進捗であれば予定通り実施可能でしょうか？',
        sentAt: now.subtract(const Duration(hours: 20)),
        isRead: true,
        readBy: ['user_1', 'user_2'],
      ),
      Message(
        id: 'msg_8',
        projectId: 'proj_1',
        senderId: 'user_1',
        sender: _users[0],
        content: '進捗確認しました。予定通り来週水曜日で問題ありません。詳細スケジュールを添付します。',
        sentAt: now.subtract(const Duration(hours: 18)),
        isRead: true,
        readBy: ['user_6'],
        attachments: [
          Attachment(
            id: 'att_msg_3',
            projectId: 'proj_1',
            name: '中間検査スケジュール.xlsx',
            url: 'https://example.com/files/inspection_schedule.xlsx',
            type: 'spreadsheet',
            size: 150000,
            uploadedBy: 'user_1',
            uploadedAt: now.subtract(const Duration(hours: 18)),
            messageId: 'msg_8',
          ),
        ],
      ),
      Message(
        id: 'msg_9',
        projectId: 'proj_1',
        senderId: 'user_2',
        sender: _users[1],
        content: '本日の作業完了しました。12Fまでの鉄骨組立が完了しました。明日は13F-14Fを進めます。',
        sentAt: now.subtract(const Duration(hours: 4)),
        isRead: true,
        readBy: ['user_1'],
      ),
      Message(
        id: 'msg_10',
        projectId: 'proj_1',
        senderId: 'user_1',
        sender: _users[0],
        content: 'お疲れ様でした。順調に進んでいますね。明日もよろしくお願いします。',
        sentAt: now.subtract(const Duration(hours: 3, minutes: 30)),
        isRead: false,
        readBy: [],
      ),
    ];
  }

  // ============== Pinned Attachments (Documents) ==============
  List<Attachment> getPinnedAttachments() {
    final now = DateTime.now();

    return [
      Attachment(
        id: 'doc_1',
        projectId: 'proj_1',
        name: '全体工程表_2024.pdf',
        url: 'https://example.com/files/master_schedule.pdf',
        type: 'pdf',
        size: 5200000,
        uploadedBy: 'user_1',
        uploadedAt: now.subtract(const Duration(days: 30)),
        isPinned: true,
        description: '2024年度マスタースケジュール',
      ),
      Attachment(
        id: 'doc_2',
        projectId: 'proj_1',
        name: '構造図_最新版.dwg',
        url: 'https://example.com/files/structure_latest.dwg',
        type: 'cad',
        size: 15000000,
        uploadedBy: 'user_4',
        uploadedAt: now.subtract(const Duration(days: 7)),
        isPinned: true,
        description: '構造図面（Rev.5）',
      ),
      Attachment(
        id: 'doc_3',
        projectId: 'proj_1',
        name: '電気設備図.pdf',
        url: 'https://example.com/files/electrical_plan.pdf',
        type: 'pdf',
        size: 8500000,
        thumbnailUrl: null,
        uploadedBy: 'user_4',
        uploadedAt: now.subtract(const Duration(days: 14)),
        isPinned: true,
        description: '電気設備配置図',
      ),
      Attachment(
        id: 'doc_4',
        projectId: 'proj_1',
        name: '安全管理マニュアル.pdf',
        url: 'https://example.com/files/safety_manual.pdf',
        type: 'pdf',
        size: 3200000,
        uploadedBy: 'user_1',
        uploadedAt: now.subtract(const Duration(days: 60)),
        isPinned: true,
        description: '現場安全管理規定',
      ),
      Attachment(
        id: 'doc_5',
        projectId: 'proj_1',
        name: '施工写真_1月.zip',
        url: 'https://example.com/files/photos_jan.zip',
        type: 'other',
        size: 125000000,
        uploadedBy: 'user_2',
        uploadedAt: now.subtract(const Duration(days: 21)),
        isPinned: true,
        description: '1月度施工写真',
      ),
    ];
  }
}
